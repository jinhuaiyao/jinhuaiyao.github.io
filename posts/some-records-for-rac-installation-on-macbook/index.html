<!DOCTYPE html>
<html lang="en-us" class="scroll-smooth">
    <head><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Some Records for RAC Installation on Macbook</title>
<meta name="description" content="这阵子比较闲了，想着好好利用一下以前的工作笔记本。">
<link rel="canonical" href="http://example.org/posts/some-records-for-rac-installation-on-macbook/">
<link rel="robots" href="/robots.txt" />

<link rel="stylesheet" href="http://example.org/css/app.min.18fa3c6f7441f42a7d6673da5f353f233db80e2afd4631db2bab10d8806931bd.css" integrity="sha256-GPo8b3RB9Cp9ZnPaXzU/Iz24Dir9RjHbK6sQ2IBpMb0=" ></head>
    <body class="max-w-screen-md px-10 mx-auto">
        <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
    
  
<div class="flex-none w-20 h-20 rounded-full overflow-hidden" >
    <a href="http://example.org/">
        <img srcset="/img/profile-picture_hu141d85d9bc1e471d962271e648f69e4d_967044_500x500_fill_q100_box_smart1.jpg 80w" src="/img/profile-picture.jpg" width="2087" height="2215" alt="Huaiyao Jin">
    </a>
</div>

    <div class="flex flex-col gap-5">
    <a href="http://example.org/">
    
    <h3 class="text-center sm:text-left text-4xl font-extrabold text-gray-800 ">Huaiyao Jin</h3>
    
</a>
    <nav>
    <ul class="flex flex-wrap justify-left uppercase text-xs font-semibold gap-7 text-gray-500 ">
        
        
        <li class="hover:text-gray-500"><a href="/">Home</a></li>
        
        <li class="hover:text-gray-500"><a href="/posts">Posts</a></li>
        
    </ul>
</nav>
    </div>
</header>
        <main id="content">
<article class="flex flex-col gap-10">
    <header class="flex flex-col gap-2">
        <h2 class="text-2xl leading-snug font-bold text-gray-900">Some Records for RAC Installation on Macbook</h2>

        <div class="text-sm font-semibold text-gray-500 flex gap-3">
        
<time datetime="2023-02-02 16:19:18 &#43;0800 CST" title="2023-02-02 16:19:18 &#43;0800 CST">
    2023/02/02
</time>
        
        </div>
    </header>
    <section class="content text-lg text-gray-800">
    <p>这阵子比较闲了，想着好好利用一下以前的工作笔记本。</p>
<p>Intel 芯片的 Macbook Pro，离职以后公司免费送给我们的福利之一。</p>
<p>决定在上面装个 Oracle RAC 测试环境。之前 2013 年的 MacBook Pro 已经在爱回收上卖掉了，上面的测试环境也就没有了。</p>
<p>以下是一些零散的记录，写在这里以后找起来也容易。</p>
<h3 id="yum-install-package-很慢">yum install package 很慢</h3>
<p>研究一番，最后发现是电信网络的问题，改用手机热点，虚拟机 IP 也跟着变化，重新 ssh，之后 yum install 就很快了。</p>
<h3 id="public-ip-网络配置">Public IP 网络配置</h3>
<p>之前都是自定义一个虚拟的网段，这次在 VMWare 里改用成和家庭网络网段一样，10.0.0.x，一个好处是 db server 可以直接访问外网，另外家庭网络里其他笔记本可以直接 ssh 到 db server（以前需要先 ssh 到笔记本上然后再 ssh 到 db server），算是一个改进。</p>
<pre><code>#Public
10.0.0.218 pve01dbs005
10.0.0.219 pve01dbs006

#Private
192.168.1.2 pve01dbs005p1
192.168.1.3 pve01dbs006p1

#Virtual
10.0.0.221 pve01dbs005v1
10.0.0.222 pve01dbs006v1

#scan
10.0.0.223 pve01dbs-scan
</code></pre>
<h3 id="avahi-daemonservice">avahi-daemon.service</h3>
<p>Oracle Linux 7.7 上安装 RAC，需要 disable 这个服务。</p>
<pre><code>systemctl status avahi-daemon.service
systemctl stop avahi-daemon.service
systemctl disable avahi-daemon.service
</code></pre>
<h3 id="vmware-里共享硬盘的配置">VMWare 里共享硬盘的配置</h3>
<p>两个虚拟机都需要一些特别的配置，不然启动节点二db server会报错，无法使用共享磁盘。以前设置过的，这次想省略这一步试试看，结果不行，老老实实配置起来。</p>
<p><img src="https://huaiyao-image-hosting.oss-cn-shanghai.aliyuncs.com/images/some-records-for-rac-installation-on-macbook-2.png" alt=""></p>
<pre><code>
# ----------------------------------------------------------------
# BEGIN SHARED STORAGE
# ----------------------------------------------------------------
# -  Here we NEW SCSI BUS. Set it to &quot;Virtual&quot; and disk.locking = &quot;false&quot;
#    
# ----------------------------------------------------------------
disk.EnableUUID = &quot;TRUE&quot;

diskLib.dataCacheMaxSize = &quot;0&quot;
diskLib.dataCacheMaxReadAheadSize = &quot;0&quot;
diskLib.dataCacheMinReadAheadSize = &quot;0&quot;
diskLib.dataCachePageSize = &quot;4096&quot;
diskLib.maxUnsyncedWrites = &quot;0&quot;
disk.locking = &quot;false&quot;
# ----------------------------------------------------------------
#   Create HBA (just as if you had a SAN storage), LSILOGIC or BUSLOGIC
# ----------------------------------------------------------------
scsi1.present = &quot;TRUE&quot;
scsi1.sharedBus = &quot;virtual&quot;
scsi1.virtualDev = &quot;lsilogic&quot;
# ----------------------------------------------------------------
#   Creating virtual SCSI disks on that HBA
# ----------------------------------------------------------------
scsi1:0.present = &quot;TRUE&quot;
scsi1:0.fileName = &quot;asm01.vmdk&quot;
scsi1:0.redo = &quot;&quot;
scsi1:0.mode = &quot;independent-persistent&quot;
scsi1:0.deviceType = &quot;disk&quot;
scsi1:1.present = &quot;TRUE&quot;
scsi1:1.fileName = &quot;asm02.vmdk&quot;
scsi1:1.redo = &quot;&quot;
scsi1:1.mode = &quot;independent-persistent&quot;
scsi1:1.deviceType = &quot;disk&quot;
scsi1:2.present = &quot;TRUE&quot;
scsi1:2.fileName = &quot;asm03.vmdk&quot;
scsi1:2.redo = &quot;&quot;
scsi1:2.mode = &quot;independent-persistent&quot;
scsi1:2.deviceType = &quot;disk&quot;

scsi1.pciSlotNumber = &quot;37&quot;
scsi0:1.fileName = &quot;vote01.vmdk&quot;
scsi0:1.present = &quot;TRUE&quot;
scsi0:1.mode = &quot;independent-persistent&quot;
scsi0:1.deviceType = &quot;disk&quot;

scsi0:2.fileName = &quot;vote02.vmdk&quot;
scsi0:2.present = &quot;TRUE&quot;
scsi0:2.mode = &quot;independent-persistent&quot;
scsi0:2.deviceType = &quot;disk&quot;

scsi0:3.fileName = &quot;vote03.vmdk&quot;
scsi0:3.present = &quot;TRUE&quot;
scsi0:3.mode = &quot;independent-persistent&quot;
scsi0:3.deviceType = &quot;disk&quot;
scsi0:3.redo = &quot;&quot;
scsi0:1.redo = &quot;&quot;
scsi0:2.redo = &quot;&quot;
#
# ----------------------------------------------------------------
# END SHARED STORAGE
# ----------------------------------------------------------------
</code></pre>
<h3 id="ocr">OCR</h3>
<p>忘记 OCR 和 Voting disk 的冗余方式了，又打开 OneNote 查看一下以前的记录，Redundancy 要选 Normal，Oracle 会生成一份冗余，asmcmd lsdg 里 Req_mir_free_MB 和 Usable_file_MB 可以看出来。</p>
<p><img src="https://huaiyao-image-hosting.oss-cn-shanghai.aliyuncs.com/images/some-records-for-rac-installation-on-macbook-3.png" alt=""></p>
<pre><code>[grid@pve01dbs005 ~]$ asmcmd lsdg vote_dg
State    Type    Rebal  Sector  Logical_Sector  Block       AU  Total_MB  Free_MB  Req_mir_free_MB  Usable_file_MB  Offline_disks  Voting_files  Name
MOUNTED  NORMAL  N         512             512   4096  4194304     15360    14420             5120            4650              0             Y  VOTE_DG/
</code></pre>
<h3 id="安装-grid-时节点一-rootsh-报错">安装 Grid 时节点一 root.sh 报错</h3>
<pre><code>2023/01/31 16:14:56 CLSRSC-594: Executing installation step 18 of 19: 'ConfigNode'.
 PRCR-1013 : Failed to start resource ora.ons
PRCR-1064 : Failed to start resource ora.ons on node pve01dbs005
CRS-2674: Start of 'ora.ons' on 'pve01dbs005' failed

2023/01/31 16:15:44 Oracle Clusterware infrastructure error in CLSECHO (OS PID 7018): ADR home path /u01/app/grid/diag/crs/pve01dbs005v1/crs does not exist; ADR initialization will try to create it
 CLSRSC-180: An error occurred while executing the command 'srvctl start nodeapps -n pve01dbs005'
2023/01/31 16:15:44 CLSRSC-287: FirstNode configuration failed
</code></pre>
<p>搜索了一下，有篇 metelink 文章正好解决这个问题，PRCR-1013 : Failed to start resource ora.ons  - 12.2 : Grid Infrastructure Installation Fails with Error “PRCR-1013 : Failed to start resource ora.ons” (Doc ID 2380526.1)</p>
<p>解决方法是：</p>
<pre><code>[root@pve01dbs005 ~]# service NetworkManager status
[root@pve01dbs005 ~]# service NetworkManager stop
[root@pve01dbs005 ~]# chkconfig NetworkManager off
</code></pre>
<p>然后重新运行 root.sh</p>
<pre><code>[root@pve01dbs005 ~]# /u01/app/19.3.0/grid/root.sh
Performing root user operation.

The following environment variables are set as:
    ORACLE_OWNER= grid
    ORACLE_HOME=  /u01/app/19.3.0/grid

Enter the full pathname of the local bin directory: [/usr/local/bin]:
The contents of &quot;dbhome&quot; have not changed. No need to overwrite.
The contents of &quot;oraenv&quot; have not changed. No need to overwrite.
The contents of &quot;coraenv&quot; have not changed. No need to overwrite.

Entries will be added to the /etc/oratab file as needed by
Database Configuration Assistant when a database is created
Finished running generic part of root script.
Now product-specific root actions will be performed.
Relinking oracle with rac_on option
Using configuration parameter file: /u01/app/19.3.0/grid/crs/install/crsconfig_params
The log of current session can be found at:
  /u01/app/grid/crsdata/pve01dbs005/crsconfig/rootcrs_pve01dbs005_2023-01-31_04-25-49PM.log
2023/01/31 16:25:54 CLSRSC-594: Executing installation step 1 of 19: 'SetupTFA'.
2023/01/31 16:25:54 CLSRSC-594: Executing installation step 2 of 19: 'ValidateEnv'.
2023/01/31 16:25:54 CLSRSC-363: User ignored prerequisites during installation
2023/01/31 16:25:54 CLSRSC-594: Executing installation step 3 of 19: 'CheckFirstNode'.
2023/01/31 16:25:54 CLSRSC-4002: Successfully installed Oracle Trace File Analyzer (TFA) Collector.
2023/01/31 16:25:55 CLSRSC-594: Executing installation step 4 of 19: 'GenSiteGUIDs'.
2023/01/31 16:25:56 CLSRSC-594: Executing installation step 5 of 19: 'SetupOSD'.
2023/01/31 16:25:56 CLSRSC-594: Executing installation step 6 of 19: 'CheckCRSConfig'.
2023/01/31 16:25:57 CLSRSC-594: Executing installation step 7 of 19: 'SetupLocalGPNP'.
2023/01/31 16:25:57 CLSRSC-594: Executing installation step 8 of 19: 'CreateRootCert'.
2023/01/31 16:26:02 CLSRSC-594: Executing installation step 9 of 19: 'ConfigOLR'.
2023/01/31 16:26:02 CLSRSC-594: Executing installation step 10 of 19: 'ConfigCHMOS'.
2023/01/31 16:26:02 CLSRSC-594: Executing installation step 11 of 19: 'CreateOHASD'.
2023/01/31 16:26:03 CLSRSC-594: Executing installation step 12 of 19: 'ConfigOHASD'.
2023/01/31 16:26:05 CLSRSC-594: Executing installation step 13 of 19: 'InstallAFD'.
2023/01/31 16:26:05 CLSRSC-594: Executing installation step 14 of 19: 'InstallACFS'.
2023/01/31 16:26:06 CLSRSC-594: Executing installation step 15 of 19: 'InstallKA'.
2023/01/31 16:26:09 CLSRSC-594: Executing installation step 16 of 19: 'InitConfig'.
2023/01/31 16:26:45 CLSRSC-594: Executing installation step 17 of 19: 'StartCluster'.
2023/01/31 16:28:12 CLSRSC-343: Successfully started Oracle Clusterware stack
2023/01/31 16:28:12 CLSRSC-594: Executing installation step 18 of 19: 'ConfigNode'.
2023/01/31 16:28:58 CLSRSC-594: Executing installation step 19 of 19: 'PostConfig'.
2023/01/31 16:29:19 CLSRSC-325: Configure Oracle Grid Infrastructure for a Cluster ... succeeded
</code></pre>
<h3 id="193-rdbms安装和-12c-不同">19.3 rdbms安装和 12c 不同</h3>
<p>和 Grid 安装方式类似，需要把 zip 文件 unzip 到预设的目录，然后运行 runInstaller。以前是随便 unzip 到一个目录，安装时候选择 ORACLE_HOME。</p>
    </section>
    
    
    

    
    

    <footer>
        
        <div class="pb-14 taxonomy-list tags-list text-gray-600 text-sm font-medium">
            
                    <a class="bg-gray-100 py-2 px-3 rounded-lg" href="/tags/oracle/" alt="Oracle" >
                        Oracle
                    </a>
            
        </div>


    </footer>
</article>

        </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1 ">
    © 2017 - 2023  
</div>
    <div class="text-xs font-semibold text-gray-500 order-1 sm:order-2">
    <ul class="flex sm:justify-end gap-5">
    
    </ul>
</div>
</footer></body>
</html>
